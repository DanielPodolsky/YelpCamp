<% layout('/layout/boilerplate')%>

<div
  id="cluster-map"
  class="mb-4"
  style="
    width: 100%;
    height: 500px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  "
  data-api-key="<%= process.env.MAPTILER_API_KEY %>"
  data-campgrounds="<%= encodeURIComponent(JSON.stringify(campgroundsGeoJSON)) %>"
></div>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="display-5 fw-bold mb-1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="40"
        height="40"
        fill="currentColor"
        class="bi bi-tree me-2"
        viewBox="0 0 16 16"
      >
        <path
          d="M8.416.223a.5.5 0 0 0-.832 0l-3 4.5A.5.5 0 0 0 5 5.5h.098L3.076 8.735A.5.5 0 0 0 3.5 9.5h.191l-1.638 3.276a.5.5 0 0 0 .447.724H7V16h2v-2.5h4.5a.5.5 0 0 0 .447-.724L12.31 9.5h.191a.5.5 0 0 0 .424-.765L10.902 5.5H11a.5.5 0 0 0 .416-.777l-3-4.5z"
        />
      </svg>
      All Campgrounds
    </h1>
    <% if (typeof totalCampgrounds !== 'undefined') { %>
    <p class="text-muted mb-0">
      <small
        >Showing <%= campgrounds.length %> of <%= totalCampgrounds %>
        campgrounds</small
      >
    </p>
    <% } %>
  </div>
  <a href="/campgrounds/new" class="btn btn-success btn-lg">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      fill="currentColor"
      class="bi bi-plus-circle me-2"
      viewBox="0 0 16 16"
    >
      <path
        d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
      />
      <path
        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"
      />
    </svg>
    Add Campground
  </a>
</div>

<% if (campgrounds.length === 0) { %>
<div class="text-center py-5">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="80"
    height="80"
    fill="currentColor"
    class="bi bi-inbox text-muted mb-3"
    viewBox="0 0 16 16"
  >
    <path
      d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4H4.98zm9.954 5H10.45a2.5 2.5 0 0 1-4.9 0H1.066l.32 2.562a.5.5 0 0 0 .497.438h12.234a.5.5 0 0 0 .496-.438L14.933 9zM3.809 3.563A1.5 1.5 0 0 1 4.981 3h6.038a1.5 1.5 0 0 1 1.172.563l3.7 4.625a.5.5 0 0 1 .105.374l-.39 3.124A1.5 1.5 0 0 1 14.117 13H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .106-.374l3.7-4.625z"
    />
  </svg>
  <h3 class="text-muted">No campgrounds yet</h3>
  <p class="text-muted">Be the first to add a campground!</p>
  <a href="/campgrounds/new" class="btn btn-primary btn-lg mt-3"
    >Create First Campground</a
  >
</div>
<% } else { %>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  <% for (let campground of campgrounds) { %>
  <div class="col">
    <div class="card h-100 shadow-sm hover-card">
      <% if (campground.images && campground.images.length > 0) { %>
      <img
        src="<%= campground.images[0].url %>"
        class="card-img-top"
        alt="<%= campground.title %>"
        style="height: 250px; object-fit: cover"
      />
      <% } else { %>
      <div
        class="card-img-top bg-secondary d-flex align-items-center justify-content-center"
        style="height: 250px"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="80"
          height="80"
          fill="currentColor"
          class="bi bi-image text-white"
          viewBox="0 0 16 16"
        >
          <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
          <path
            d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"
          />
        </svg>
      </div>
      <% } %>
      <div class="card-body d-flex flex-column">
        <h5 class="card-title fw-bold"><%= campground.title %></h5>
        <p class="card-text text-muted flex-grow-1">
          <%= campground.description.substring(0, 100) %><%=
          campground.description.length > 100 ? '...' : '' %>
        </p>
        <div class="mb-2">
          <small class="text-muted">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              fill="currentColor"
              class="bi bi-geo-alt me-1"
              viewBox="0 0 16 16"
            >
              <path
                d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z"
              />
              <path
                d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
              />
            </svg>
            <%= campground.location %>
          </small>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <span class="h5 mb-0 text-success"
            >$<%= campground.price %>/night</span
          >
          <a href="/campgrounds/<%= campground._id %>" class="btn btn-primary">
            View Details
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              fill="currentColor"
              class="bi bi-arrow-right ms-1"
              viewBox="0 0 16 16"
            >
              <path
                fill-rule="evenodd"
                d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"
              />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
  <% } %>
</div>

<!-- Pagination -->
<% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
<nav aria-label="Campgrounds pagination" class="mt-5">
  <ul class="pagination pagination-lg justify-content-center">
    <!-- Previous Button -->
    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
      <a
        class="page-link"
        href="/campgrounds?page=<%= currentPage - 1 %>"
        aria-label="Previous"
      >
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <!-- First page if not in range -->
    <% if (startPage > 1) { %>
    <li class="page-item">
      <a class="page-link" href="/campgrounds?page=1">1</a>
    </li>
    <% if (startPage > 2) { %>
    <li class="page-item disabled">
      <span class="page-link">...</span>
    </li>
    <% } %> <% } %>

    <!-- Page numbers -->
    <% for (let i = startPage; i <= endPage; i++) { %>
    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
      <a class="page-link" href="/campgrounds?page=<%= i %>"><%= i %></a>
    </li>
    <% } %>

    <!-- Last page if not in range -->
    <% if (endPage < totalPages) { %> <% if (endPage < totalPages - 1) { %>
    <li class="page-item disabled">
      <span class="page-link">...</span>
    </li>
    <% } %>
    <li class="page-item">
      <a class="page-link" href="/campgrounds?page=<%= totalPages %>"
        ><%= totalPages %></a
      >
    </li>
    <% } %>

    <!-- Next Button -->
    <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
      <a
        class="page-link"
        href="/campgrounds?page=<%= currentPage + 1 %>"
        aria-label="Next"
      >
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
<% } %> <% } %>

<style>
  .hover-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }
  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2) !important;
  }

  .pagination .page-link {
    color: #198754;
    border-color: #dee2e6;
  }

  .pagination .page-item.active .page-link {
    background-color: #198754;
    border-color: #198754;
    color: white;
  }

  .pagination .page-link:hover {
    color: #146c43;
    background-color: #e9ecef;
    border-color: #dee2e6;
  }
</style>

<script src="/javascripts/clusterMap.js"></script>
